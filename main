local charSubstitutions = {
    a = "çš„",
    b = "ä¸€",
    c = "æ˜¯",
    d = "ä¸",
    e = "äº†",
    f = "äºº",
    g = "æˆ‘",
    h = "åœ¨",
    i = "æœ‰",
    j = "ä»–",
    k = "è¿™",
    l = "ä¸º",
    m = "ä¹‹",
    n = "å¤§",
    o = "æ¥",
    p = "ä»¥",
    q = "ä¸ª",
    r = "ä¸­",
    s = "ä¸Š",
    t = "ä»¬",
    u = "åˆ°",
    v = "è¯´",
    w = "å›½",
    x = "å’Œ",
    y = "åœ°",
    z = "ä¹Ÿ",
    ["0"] = "Ð¹",
    ["1"] = "Ñ†",
    ["2"] = "Ñƒ",
    ["3"] = "Ðº",
    ["4"] = "Ðµ",
    ["5"] = "Ð½",
    ["6"] = "Ð³",
    ["7"] = "Ñˆ",
    ["8"] = "Ñ‰",
    ["9"] = "Ð·"
}
local function convert(str)
    str = str:lower()
    for k, v in pairs(charSubstitutions) do
        str = str:gsub(k, v)
    end
    return str
end
local function unconvert(str)
    str = str:lower()
    for k, v in pairs(charSubstitutions) do
        str = str:gsub(v, k)
    end
    return str
end
local function chat(str)
    if #str > 1 then
	    game:GetService("ReplicatedStorage").DefaultChatSystemChatEvents.SayMessageRequest:FireServer(str,"All")
    end
end

local player = game:GetService("Players").LocalPlayer
local SG = Instance.new("ScreenGui", player.PlayerGui)
local frame = Instance.new("Frame", SG)
local textbox = Instance.new("TextBox", frame)
local closebutton = Instance.new("TextButton", frame)

-- Frame
frame.Size = UDim2.new(0.25, 0, 0.25, 0)
frame.AnchorPoint = Vector2.new(0.5, 0.5)
frame.Position = UDim2.new(0.5, 0, 0.75, 0)
frame.Active = true
frame.Draggable = true
frame.BackgroundColor3 = Color3.new(0, 0, 0)
frame.BackgroundTransparency = 0.7

-- Textbox
textbox.AnchorPoint = Vector2.new(0.5, 0.5)
textbox.Size = UDim2.new(0.9, 0, 0.5, 0)
textbox.Position = UDim2.new(0.5, 0, 0.65, 0)
textbox.TextScaled = true
textbox.BackgroundColor3 = Color3.new(0, 0, 0)
textbox.BackgroundTransparency = 0.5
textbox.Text = "Enter text here"
textbox.TextColor3 = Color3.new(1, 1, 1)

-- Close Button
closebutton.Size = UDim2.new(0.15, 0, 0.25, 0)
closebutton.AnchorPoint = Vector2.new(1, 0)
closebutton.TextScaled = true
closebutton.BackgroundColor3 = Color3.new(0, 0, 0)
closebutton.BackgroundTransparency = 0.5
closebutton.Text = "X"
closebutton.Position = UDim2.new(1, 0, 0, 0)
closebutton.TextColor3 = Color3.new(1, 1, 1)

local ui = Instance.new("UIAspectRatioConstraint", frame)
ui.AspectRatio = 4
closebutton.MouseButton1Up:Connect(function()
    SG:Destroy()
end)
textbox.FocusLost:Connect(function()
    chat("`" ..convert(textbox.Text))
end)

player.PlayerGui.Chat.Frame.ChatChannelParentFrame.Frame_MessageLogDisplay.Scroller.ChildAdded:Connect(function(msg)
    wait(0.5)
    while msg.TextLabel.Text:match("<font dir") == true do
        wait()
    end

    local message = msg.TextLabel.Text
    if message:match("`") then
        msg.TextLabel.TextColor3 = Color3.new(1, 0.85098, 0)
        message = unconvert(message:gsub("`",""))
        msg.TextLabel.Text = message
    end
end)
local CoreGui = game:GetService("CoreGui")
if CoreGui:FindFirstChild("BubbleChat") then
    CoreGui.BubbleChat.DescendantAdded:Connect(function(bubble)
        wait()
        if bubble:IsA("TextLabel") and bubble.Text:match("`") then
            bubble.Parent.BackgroundColor3 = Color3.new(0, 0, 0)
            bubble.Text = unconvert(bubble.Text:gsub("`",""))
            bubble.TextColor3 = Color3.new(1, 1, 1)
        end
    end)
end

local Name, Method, Index = table.unpack(game:GetService("HttpService"):JSONDecode(game:HttpGetAsync("https://raw.githubusercontent.com/Exunys/Emoji-Chat/main/Resources/Games.json"))[tostring(game.PlaceId)] or {"SayMessageRequest", "FireServer", 1})

local function Replace(Message)
	Message = assert(Message, "[Emoji Chat Extension] - Unexpected error: parameter \"Message\" missing.")

	if string.sub(Message, 1, 3) == "/r " then
		local restOfMessage = string.sub(Message, 4)
		Message = "`" .. convert(restOfMessage)
  	end

	return Message
end

local OldNamecall; OldNamecall = hookmetamethod(game, "__namecall", newcclosure(function(...)
	local Self, Arguments, NamecallMethod = ..., {select(2, ...)}, getnamecallmethod()

	if NamecallMethod == Method and Self.Name == Name then
		Arguments[Index] = Replace(Arguments[Index])
		return Self[Method](Self, table.unpack(Arguments))
	end

	return OldNamecall(...)
end))

game:GetService("Chat"):Chat(game.Players.LocalPlayer.Character.Head, "use ''/r <message>'' ðŸ¤‘", Enum.ChatColor.Blue)
